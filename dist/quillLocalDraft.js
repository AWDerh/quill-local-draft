(()=>{"use strict";var t=function(){return(t=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var o in i=arguments[n])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t}).apply(this,arguments)},i={id:"",prefix:"quill_local_draft",saveDelay:1e3,displaySave:!0,bindInitial:!0};!function(){function n(t,i){this.quill=t,this.options=this.applyOptions(i),this.initialized=!1,this.options.bindInitial&&this.bindInitialListener()}n.prototype.init=function(){this.initialized||(this.initialized=!0,this.loadDraft(),this.bindListener())},n.prototype.bindInitialListener=function(){var t=this;if(this.initialized)return this.bindListener();this.unbindListener(),this.listener=function(){return t.init()},this.quill.once("text-change",this.listener)},n.prototype.bindListener=function(){var t=this;this.unbindListener();var i=function(){return t.saveDraft()};this.listener=this.options.saveDelay?function(t,i,n,e){var o,r=!1,s=0;function a(){o&&clearTimeout(o)}function l(){for(var l=arguments.length,u=new Array(l),c=0;c<l;c++)u[c]=arguments[c];var f=this,h=Date.now()-s;function p(){s=Date.now(),n.apply(f,u)}function d(){o=void 0}r||(e&&!o&&p(),a(),void 0===e&&h>t?p():!0!==i&&(o=setTimeout(e?d:p,void 0===e?t-h:t)))}return"boolean"!=typeof i&&(e=n,n=i,i=void 0),l.cancel=function(){a(),r=!0},l}(this.options.saveDelay,i):i,this.quill.on("text-change",this.listener)},n.prototype.unbindListener=function(){this.listener&&this.quill.off("text-change",this.listener)},n.prototype.applyOptions=function(n){return t(t({},i),n)},Object.defineProperty(n.prototype,"id",{get:function(){var t;return(null!==(t=this.options.prefix)&&void 0!==t?t:"")+"_"+this.options.id},enumerable:!1,configurable:!0}),n.prototype.getContents=function(){return JSON.stringify(this.quill.getContents())},n.prototype.setContents=function(t){var i=null;try{i=JSON.parse(t)}catch(t){return void console.error("Could not parse local draft Delta.")}i&&this.quill.setContents(i)},n.prototype.getDraft=function(){var t,i=this.id,n="";try{n=null!==(t=localStorage.getItem(i))&&void 0!==t?t:""}catch(t){}return n},n.prototype.setDraft=function(t){void 0===t&&(t="");var i=this.id;try{localStorage.setItem(i,t)}catch(t){if(!(t instanceof DOMException&&t.code==t.QUOTA_EXCEEDED_ERR))throw t;console.error("Could not save local draft",t)}},n.prototype.saveDraft=function(){var t=this.getContents();this.setDraft(t)},n.prototype._loadDraft=function(){var t=this.getDraft();this.setContents(t)},n.prototype.editorIsEmpty=function(){return 0==this.quill.getText().trim().length},n.prototype.loadDraft=function(){return!(!this.editorIsEmpty()&&!window.confirm("There is a local saved draft for this notebook, but loading it would reset the editor. Do you still want to load the draft?"))&&this._loadDraft()}}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9xdWlsbC1sb2NhbC1kcmFmdC8uL3NyYy9RdWlsbExvY2FsRHJhZnQudHMiLCJ3ZWJwYWNrOi8vcXVpbGwtbG9jYWwtZHJhZnQvLi9ub2RlX21vZHVsZXMvdGhyb3R0bGUtZGVib3VuY2UvZXNtL2luZGV4LmpzIl0sIm5hbWVzIjpbIl9fYXNzaWduIiwiT2JqZWN0IiwiYXNzaWduIiwidCIsInMiLCJpIiwibiIsImFyZ3VtZW50cyIsImxlbmd0aCIsInAiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJhcHBseSIsInRoaXMiLCJERUZBVUxUX09QVElPTlMiLCJpZCIsInByZWZpeCIsInNhdmVEZWxheSIsImRpc3BsYXlTYXZlIiwiYmluZEluaXRpYWwiLCJRdWlsbExvY2FsRHJhZnQiLCJxdWlsbCIsIm9wdGlvbnMiLCJhcHBseU9wdGlvbnMiLCJpbml0aWFsaXplZCIsImJpbmRJbml0aWFsTGlzdGVuZXIiLCJpbml0IiwibG9hZERyYWZ0IiwiYmluZExpc3RlbmVyIiwiX3RoaXMiLCJ1bmJpbmRMaXN0ZW5lciIsImxpc3RlbmVyIiwib25jZSIsInNhdmVEcmFmdCIsImRlbGF5Iiwibm9UcmFpbGluZyIsImNhbGxiYWNrIiwiZGVib3VuY2VNb2RlIiwidGltZW91dElEIiwiY2FuY2VsbGVkIiwibGFzdEV4ZWMiLCJjbGVhckV4aXN0aW5nVGltZW91dCIsImNsZWFyVGltZW91dCIsIndyYXBwZXIiLCJfbGVuIiwiYXJndW1lbnRzXyIsIkFycmF5IiwiX2tleSIsInNlbGYiLCJlbGFwc2VkIiwiRGF0ZSIsIm5vdyIsImV4ZWMiLCJjbGVhciIsInVuZGVmaW5lZCIsInNldFRpbWVvdXQiLCJjYW5jZWwiLCJ0aHJvdHRsZSIsIm9uIiwib2ZmIiwiZGVmaW5lUHJvcGVydHkiLCJnZXQiLCJfYSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJnZXRDb250ZW50cyIsIkpTT04iLCJzdHJpbmdpZnkiLCJzZXRDb250ZW50cyIsImNvbnRlbnRzIiwiZGVzZXJpYWxpemVkIiwicGFyc2UiLCJlIiwiY29uc29sZSIsImVycm9yIiwiZ2V0RHJhZnQiLCJkcmFmdCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXREcmFmdCIsImNvbnRlbnQiLCJzZXRJdGVtIiwiRE9NRXhjZXB0aW9uIiwiY29kZSIsIlFVT1RBX0VYQ0VFREVEX0VSUiIsIl9sb2FkRHJhZnQiLCJlZGl0b3JJc0VtcHR5IiwiZ2V0VGV4dCIsInRyaW0iLCJ3aW5kb3ciLCJjb25maXJtIl0sIm1hcHBpbmdzIjoibUJBR0EsSUFBSUEsRUFBc0MsV0FTdEMsT0FSQUEsRUFBV0MsT0FBT0MsUUFBVSxTQUFTQyxHQUNqQyxJQUFLLElBQUlDLEVBQUdDLEVBQUksRUFBR0MsRUFBSUMsVUFBVUMsT0FBUUgsRUFBSUMsRUFBR0QsSUFFNUMsSUFBSyxJQUFJSSxLQURUTCxFQUFJRyxVQUFVRixHQUNPSixPQUFPUyxVQUFVQyxlQUFlQyxLQUFLUixFQUFHSyxLQUN6RE4sRUFBRU0sR0FBS0wsRUFBRUssSUFFakIsT0FBT04sSUFFS1UsTUFBTUMsS0FBTVAsWUFHckJRLEVBQWtCLENBQ3pCQyxHQUFJLEdBQ0pDLE9BQVEsb0JBQ1JDLFVBQVcsSUFDWEMsYUFBYSxFQUNiQyxhQUFhLElBRW9CLFdBQ2pDLFNBQVNDLEVBQWdCQyxFQUFPQyxHQUM1QlQsS0FBS1EsTUFBUUEsRUFDYlIsS0FBS1MsUUFBVVQsS0FBS1UsYUFBYUQsR0FPakNULEtBQUtXLGFBQWMsRUFDZlgsS0FBS1MsUUFBUUgsYUFDYk4sS0FBS1ksc0JBRWJMLEVBQWdCWCxVQUFVaUIsS0FBTyxXQUN6QmIsS0FBS1csY0FFVFgsS0FBS1csYUFBYyxFQUNuQlgsS0FBS2MsWUFDTGQsS0FBS2UsaUJBRVRSLEVBQWdCWCxVQUFVZ0Isb0JBQXNCLFdBQzVDLElBQUlJLEVBQVFoQixLQUNaLEdBQUlBLEtBQUtXLFlBQ0wsT0FBT1gsS0FBS2UsZUFDaEJmLEtBQUtpQixpQkFFTGpCLEtBQUtrQixTQURVLFdBQWMsT0FB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Y0FDcEJwRCxLQUFLa0UsU0FBU1YsSUFFbEJqRCxFQUFnQlgsVUFBVTRFLFdBQWEsV0FDbkMsSUFBSVQsRUFBUS9ELEtBQUs4RCxXQUNqQjlELEtBQUt1RCxZQUFZUSxJQUVyQnhELEVBQWdCWCxVQUFVNkUsY0FBZ0IsV0FDdEMsT0FBNkMsR0FBdEN6RSxLQUFLUSxNQUFNa0UsVUFBVUMsT0FBT2pGLFFBRXZDYSxFQUFnQlgsVUFBVWtCLFVBQVksV0FDbEMsU0FBS2QsS0FBS3lFLGtCQUNERyxPQUFPQyxRQUFRLGlJQUtqQjdFLEtBQUt3RSxjQWpIZ0IsSSIsImZpbGUiOiJxdWlsbExvY2FsRHJhZnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogRm9yIGN1c3RvbSB0eXBlcywgZXh0ZW5kIHRoaXMgcGx1Z2luIGFuZCBvdmVycmlkZSBAc2VlIGdldENvbnRlbnRzIC4uXHJcbiAqL1xyXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBmdW5jdGlvbiAoKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXHJcbiAgICAgICAgICAgICAgICB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn07XHJcbmltcG9ydCB7IHRocm90dGxlIH0gZnJvbSAndGhyb3R0bGUtZGVib3VuY2UnO1xyXG5leHBvcnQgdmFyIERFRkFVTFRfT1BUSU9OUyA9IHtcclxuICAgIGlkOiAnJyxcclxuICAgIHByZWZpeDogJ3F1aWxsX2xvY2FsX2RyYWZ0JyxcclxuICAgIHNhdmVEZWxheTogMTAwMCxcclxuICAgIGRpc3BsYXlTYXZlOiB0cnVlLFxyXG4gICAgYmluZEluaXRpYWw6IHRydWVcclxufTtcclxudmFyIFF1aWxsTG9jYWxEcmFmdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFF1aWxsTG9jYWxEcmFmdChxdWlsbCwgb3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMucXVpbGwgPSBxdWlsbDtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSB0aGlzLmFwcGx5T3B0aW9ucyhvcHRpb25zKTtcclxuICAgICAgICAvKlxyXG4gICAgICAgIFF1aWxsIHN0YXJ0J3MgdXAgd2l0aCBhIERPTSBsb2FkIGFuZCB0aGVuIG92ZXJ3cml0ZXMgdGhlIGVkaXRvciwgc28gd2UgY2FuJ3QgbG9hZCB0aGUgZHJhZnQganVzdCB5ZXQuXHJcbiAgICAgICAgVW5mb3J0dW5hdGVseSwgdGhlcmUncyBubyByZWxpYWJsZSBob29rIGVpdGhlci4uLiB0aGUgdGV4dCBlZGl0b3IgY2hhbmdlIGV2ZW50XHJcbiAgICAgICAgZG9lc24ndCBnZXQgY2FsbGVkIHVubGVzcyB0aGVyZSdzIHByZWRlZmluZWQgSFRNTCBjb250ZW50LiBTbyB3ZSByZWx5IG9uIGFwcGxpY2F0aW9uLXNwZWNpZmljXHJcbiAgICAgICAgaW5pdGlhbGl6YXRpb24uXHJcbiAgICAgICAgKi9cclxuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5iaW5kSW5pdGlhbClcclxuICAgICAgICAgICAgdGhpcy5iaW5kSW5pdGlhbExpc3RlbmVyKCk7XHJcbiAgICB9XHJcbiAgICBRdWlsbExvY2FsRHJhZnQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5pdGlhbGl6ZWQpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmxvYWREcmFmdCgpO1xyXG4gICAgICAgIHRoaXMuYmluZExpc3RlbmVyKCk7XHJcbiAgICB9O1xyXG4gICAgUXVpbGxMb2NhbERyYWZ0LnByb3RvdHlwZS5iaW5kSW5pdGlhbExpc3RlbmVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5pdGlhbGl6ZWQpXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmJpbmRMaXN0ZW5lcigpO1xyXG4gICAgICAgIHRoaXMudW5iaW5kTGlzdGVuZXIoKTtcclxuICAgICAgICB2YXIgbGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5pbml0KCk7IH07XHJcbiAgICAgICAgdGhpcy5saXN0ZW5lciA9IGxpc3RlbmVyO1xyXG4gICAgICAgIHRoaXMucXVpbGwub25jZSgndGV4dC1jaGFuZ2UnLCB0aGlzLmxpc3RlbmVyKTtcclxuICAgIH07XHJcbiAgICBRdWlsbExvY2FsRHJhZnQucHJvdG90eXBlLmJpbmRMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMudW5iaW5kTGlzdGVuZXIoKTtcclxuICAgICAgICB2YXIgbGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zYXZlRHJhZnQoKTsgfTtcclxuICAgICAgICB0aGlzLmxpc3RlbmVyID0gdGhpcy5vcHRpb25zLnNhdmVEZWxheSA/IHRocm90dGxlKHRoaXMub3B0aW9ucy5zYXZlRGVsYXksIGxpc3RlbmVyKSA6IGxpc3RlbmVyO1xyXG4gICAgICAgIHRoaXMucXVpbGwub24oJ3RleHQtY2hhbmdlJywgdGhpcy5saXN0ZW5lcik7XHJcbiAgICB9O1xyXG4gICAgUXVpbGxMb2NhbERyYWZ0LnByb3RvdHlwZS51bmJpbmRMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMubGlzdGVuZXIpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB0aGlzLnF1aWxsLm9mZigndGV4dC1jaGFuZ2UnLCB0aGlzLmxpc3RlbmVyKTtcclxuICAgIH07XHJcbiAgICBRdWlsbExvY2FsRHJhZnQucHJvdG90eXBlLmFwcGx5T3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBERUZBVUxUX09QVElPTlMpLCBvcHRpb25zKTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUXVpbGxMb2NhbERyYWZ0LnByb3RvdHlwZSwgXCJpZFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBfYTtcclxuICAgICAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLm9wdGlvbnMucHJlZml4KSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAnJykgKyAnXycgKyB0aGlzLm9wdGlvbnMuaWQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgUXVpbGxMb2NhbERyYWZ0LnByb3RvdHlwZS5nZXRDb250ZW50cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5xdWlsbC5nZXRDb250ZW50cygpKTtcclxuICAgIH07XHJcbiAgICBRdWlsbExvY2FsRHJhZnQucHJvdG90eXBlLnNldENvbnRlbnRzID0gZnVuY3Rpb24gKGNvbnRlbnRzKSB7XHJcbiAgICAgICAgdmFyIGRlc2VyaWFsaXplZCA9IG51bGw7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgZGVzZXJpYWxpemVkID0gSlNPTi5wYXJzZShjb250ZW50cyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDb3VsZCBub3QgcGFyc2UgbG9jYWwgZHJhZnQgRGVsdGEuXCIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkZXNlcmlhbGl6ZWQpXHJcbiAgICAgICAgICAgIHRoaXMucXVpbGwuc2V0Q29udGVudHMoZGVzZXJpYWxpemVkKTtcclxuICAgIH07XHJcbiAgICBRdWlsbExvY2FsRHJhZnQucHJvdG90eXBlLmdldERyYWZ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICB2YXIgaWQgPSB0aGlzLmlkO1xyXG4gICAgICAgIHZhciBkcmFmdCA9ICcnO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGRyYWZ0ID0gKF9hID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oaWQpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgLy8gP1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZHJhZnQ7XHJcbiAgICB9O1xyXG4gICAgUXVpbGxMb2NhbERyYWZ0LnByb3RvdHlwZS5zZXREcmFmdCA9IGZ1bmN0aW9uIChjb250ZW50KSB7XHJcbiAgICAgICAgaWYgKGNvbnRlbnQgPT09IHZvaWQgMCkgeyBjb250ZW50ID0gJyc7IH1cclxuICAgICAgICB2YXIgaWQgPSB0aGlzLmlkO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGlkLCBjb250ZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBET01FeGNlcHRpb24gJiYgZS5jb2RlID09IGUuUVVPVEFfRVhDRUVERURfRVJSKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ291bGQgbm90IHNhdmUgbG9jYWwgZHJhZnRcIiwgZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyAoZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUXVpbGxMb2NhbERyYWZ0LnByb3RvdHlwZS5zYXZlRHJhZnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGNvbnRlbnRzID0gdGhpcy5nZXRDb250ZW50cygpO1xyXG4gICAgICAgIHRoaXMuc2V0RHJhZnQoY29udGVudHMpO1xyXG4gICAgfTtcclxuICAgIFF1aWxsTG9jYWxEcmFmdC5wcm90b3R5cGUuX2xvYWREcmFmdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZHJhZnQgPSB0aGlzLmdldERyYWZ0KCk7XHJcbiAgICAgICAgdGhpcy5zZXRDb250ZW50cyhkcmFmdCk7XHJcbiAgICB9O1xyXG4gICAgUXVpbGxMb2NhbERyYWZ0LnByb3RvdHlwZS5lZGl0b3JJc0VtcHR5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnF1aWxsLmdldFRleHQoKS50cmltKCkubGVuZ3RoID09IDA7XHJcbiAgICB9O1xyXG4gICAgUXVpbGxMb2NhbERyYWZ0LnByb3RvdHlwZS5sb2FkRHJhZnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmVkaXRvcklzRW1wdHkoKSkge1xyXG4gICAgICAgICAgICBpZiAoIXdpbmRvdy5jb25maXJtKFwiVGhlcmUgaXMgYSBsb2NhbCBzYXZlZCBkcmFmdCBmb3IgdGhpcyBub3RlYm9vayxcIlxyXG4gICAgICAgICAgICAgICAgKyBcIiBidXQgbG9hZGluZyBpdCB3b3VsZCByZXNldCB0aGUgZWRpdG9yLiBEbyB5b3Ugc3RpbGwgd2FudCB0byBsb2FkIHRoZSBkcmFmdD9cIikpXHJcbiAgICAgICAgICAgICAgICAvLyBjYW4gdGhleSBub3QgdW5kbyB0aGUgZHJhZnQgbG9hZD9cclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xvYWREcmFmdCgpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBRdWlsbExvY2FsRHJhZnQ7XHJcbn0oKSk7XHJcbmV4cG9ydCB7IFF1aWxsTG9jYWxEcmFmdCB9O1xyXG5leHBvcnQgZGVmYXVsdCBRdWlsbExvY2FsRHJhZnQ7XHJcbiIsIi8qIGVzbGludC1kaXNhYmxlIG5vLXVuZGVmaW5lZCxuby1wYXJhbS1yZWFzc2lnbixuby1zaGFkb3cgKi9cblxuLyoqXG4gKiBUaHJvdHRsZSBleGVjdXRpb24gb2YgYSBmdW5jdGlvbi4gRXNwZWNpYWxseSB1c2VmdWwgZm9yIHJhdGUgbGltaXRpbmdcbiAqIGV4ZWN1dGlvbiBvZiBoYW5kbGVycyBvbiBldmVudHMgbGlrZSByZXNpemUgYW5kIHNjcm9sbC5cbiAqXG4gKiBAcGFyYW0gIHtudW1iZXJ9ICAgIGRlbGF5IC0gICAgICAgICAgQSB6ZXJvLW9yLWdyZWF0ZXIgZGVsYXkgaW4gbWlsbGlzZWNvbmRzLiBGb3IgZXZlbnQgY2FsbGJhY2tzLCB2YWx1ZXMgYXJvdW5kIDEwMCBvciAyNTAgKG9yIGV2ZW4gaGlnaGVyKSBhcmUgbW9zdCB1c2VmdWwuXG4gKiBAcGFyYW0gIHtib29sZWFufSAgIFtub1RyYWlsaW5nXSAtICAgT3B0aW9uYWwsIGRlZmF1bHRzIHRvIGZhbHNlLiBJZiBub1RyYWlsaW5nIGlzIHRydWUsIGNhbGxiYWNrIHdpbGwgb25seSBleGVjdXRlIGV2ZXJ5IGBkZWxheWAgbWlsbGlzZWNvbmRzIHdoaWxlIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdHRsZWQtZnVuY3Rpb24gaXMgYmVpbmcgY2FsbGVkLiBJZiBub1RyYWlsaW5nIGlzIGZhbHNlIG9yIHVuc3BlY2lmaWVkLCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIG9uZSBmaW5hbCB0aW1lXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyIHRoZSBsYXN0IHRocm90dGxlZC1mdW5jdGlvbiBjYWxsLiAoQWZ0ZXIgdGhlIHRocm90dGxlZC1mdW5jdGlvbiBoYXMgbm90IGJlZW4gY2FsbGVkIGZvciBgZGVsYXlgIG1pbGxpc2Vjb25kcyxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIGludGVybmFsIGNvdW50ZXIgaXMgcmVzZXQpLlxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAtICAgICAgIEEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgYWZ0ZXIgZGVsYXkgbWlsbGlzZWNvbmRzLiBUaGUgYHRoaXNgIGNvbnRleHQgYW5kIGFsbCBhcmd1bWVudHMgYXJlIHBhc3NlZCB0aHJvdWdoLCBhcy1pcyxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gYGNhbGxiYWNrYCB3aGVuIHRoZSB0aHJvdHRsZWQtZnVuY3Rpb24gaXMgZXhlY3V0ZWQuXG4gKiBAcGFyYW0gIHtib29sZWFufSAgIFtkZWJvdW5jZU1vZGVdIC0gSWYgYGRlYm91bmNlTW9kZWAgaXMgdHJ1ZSAoYXQgYmVnaW4pLCBzY2hlZHVsZSBgY2xlYXJgIHRvIGV4ZWN1dGUgYWZ0ZXIgYGRlbGF5YCBtcy4gSWYgYGRlYm91bmNlTW9kZWAgaXMgZmFsc2UgKGF0IGVuZCksXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlIGBjYWxsYmFja2AgdG8gZXhlY3V0ZSBhZnRlciBgZGVsYXlgIG1zLlxuICpcbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gIEEgbmV3LCB0aHJvdHRsZWQsIGZ1bmN0aW9uLlxuICovXG5mdW5jdGlvbiB0aHJvdHRsZSAoZGVsYXksIG5vVHJhaWxpbmcsIGNhbGxiYWNrLCBkZWJvdW5jZU1vZGUpIHtcbiAgLypcbiAgICogQWZ0ZXIgd3JhcHBlciBoYXMgc3RvcHBlZCBiZWluZyBjYWxsZWQsIHRoaXMgdGltZW91dCBlbnN1cmVzIHRoYXRcbiAgICogYGNhbGxiYWNrYCBpcyBleGVjdXRlZCBhdCB0aGUgcHJvcGVyIHRpbWVzIGluIGB0aHJvdHRsZWAgYW5kIGBlbmRgXG4gICAqIGRlYm91bmNlIG1vZGVzLlxuICAgKi9cbiAgdmFyIHRpbWVvdXRJRDtcbiAgdmFyIGNhbmNlbGxlZCA9IGZhbHNlOyAvLyBLZWVwIHRyYWNrIG9mIHRoZSBsYXN0IHRpbWUgYGNhbGxiYWNrYCB3YXMgZXhlY3V0ZWQuXG5cbiAgdmFyIGxhc3RFeGVjID0gMDsgLy8gRnVuY3Rpb24gdG8gY2xlYXIgZXhpc3RpbmcgdGltZW91dFxuXG4gIGZ1bmN0aW9uIGNsZWFyRXhpc3RpbmdUaW1lb3V0KCkge1xuICAgIGlmICh0aW1lb3V0SUQpIHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SUQpO1xuICAgIH1cbiAgfSAvLyBGdW5jdGlvbiB0byBjYW5jZWwgbmV4dCBleGVjXG5cblxuICBmdW5jdGlvbiBjYW5jZWwoKSB7XG4gICAgY2xlYXJFeGlzdGluZ1RpbWVvdXQoKTtcbiAgICBjYW5jZWxsZWQgPSB0cnVlO1xuICB9IC8vIGBub1RyYWlsaW5nYCBkZWZhdWx0cyB0byBmYWxzeS5cblxuXG4gIGlmICh0eXBlb2Ygbm9UcmFpbGluZyAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgZGVib3VuY2VNb2RlID0gY2FsbGJhY2s7XG4gICAgY2FsbGJhY2sgPSBub1RyYWlsaW5nO1xuICAgIG5vVHJhaWxpbmcgPSB1bmRlZmluZWQ7XG4gIH1cbiAgLypcbiAgICogVGhlIGB3cmFwcGVyYCBmdW5jdGlvbiBlbmNhcHN1bGF0ZXMgYWxsIG9mIHRoZSB0aHJvdHRsaW5nIC8gZGVib3VuY2luZ1xuICAgKiBmdW5jdGlvbmFsaXR5IGFuZCB3aGVuIGV4ZWN1dGVkIHdpbGwgbGltaXQgdGhlIHJhdGUgYXQgd2hpY2ggYGNhbGxiYWNrYFxuICAgKiBpcyBleGVjdXRlZC5cbiAgICovXG5cblxuICBmdW5jdGlvbiB3cmFwcGVyKCkge1xuICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBhcmd1bWVudHNfID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgYXJndW1lbnRzX1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgICB9XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdmFyIGVsYXBzZWQgPSBEYXRlLm5vdygpIC0gbGFzdEV4ZWM7XG5cbiAgICBpZiAoY2FuY2VsbGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfSAvLyBFeGVjdXRlIGBjYWxsYmFja2AgYW5kIHVwZGF0ZSB0aGUgYGxhc3RFeGVjYCB0aW1lc3RhbXAuXG5cblxuICAgIGZ1bmN0aW9uIGV4ZWMoKSB7XG4gICAgICBsYXN0RXhlYyA9IERhdGUubm93KCk7XG4gICAgICBjYWxsYmFjay5hcHBseShzZWxmLCBhcmd1bWVudHNfKTtcbiAgICB9XG4gICAgLypcbiAgICAgKiBJZiBgZGVib3VuY2VNb2RlYCBpcyB0cnVlIChhdCBiZWdpbikgdGhpcyBpcyB1c2VkIHRvIGNsZWFyIHRoZSBmbGFnXG4gICAgICogdG8gYWxsb3cgZnV0dXJlIGBjYWxsYmFja2AgZXhlY3V0aW9ucy5cbiAgICAgKi9cblxuXG4gICAgZnVuY3Rpb24gY2xlYXIoKSB7XG4gICAgICB0aW1lb3V0SUQgPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgaWYgKGRlYm91bmNlTW9kZSAmJiAhdGltZW91dElEKSB7XG4gICAgICAvKlxuICAgICAgICogU2luY2UgYHdyYXBwZXJgIGlzIGJlaW5nIGNhbGxlZCBmb3IgdGhlIGZpcnN0IHRpbWUgYW5kXG4gICAgICAgKiBgZGVib3VuY2VNb2RlYCBpcyB0cnVlIChhdCBiZWdpbiksIGV4ZWN1dGUgYGNhbGxiYWNrYC5cbiAgICAgICAqL1xuICAgICAgZXhlYygpO1xuICAgIH1cblxuICAgIGNsZWFyRXhpc3RpbmdUaW1lb3V0KCk7XG5cbiAgICBpZiAoZGVib3VuY2VNb2RlID09PSB1bmRlZmluZWQgJiYgZWxhcHNlZCA+IGRlbGF5KSB7XG4gICAgICAvKlxuICAgICAgICogSW4gdGhyb3R0bGUgbW9kZSwgaWYgYGRlbGF5YCB0aW1lIGhhcyBiZWVuIGV4Y2VlZGVkLCBleGVjdXRlXG4gICAgICAgKiBgY2FsbGJhY2tgLlxuICAgICAgICovXG4gICAgICBleGVjKCk7XG4gICAgfSBlbHNlIGlmIChub1RyYWlsaW5nICE9PSB0cnVlKSB7XG4gICAgICAvKlxuICAgICAgICogSW4gdHJhaWxpbmcgdGhyb3R0bGUgbW9kZSwgc2luY2UgYGRlbGF5YCB0aW1lIGhhcyBub3QgYmVlblxuICAgICAgICogZXhjZWVkZWQsIHNjaGVkdWxlIGBjYWxsYmFja2AgdG8gZXhlY3V0ZSBgZGVsYXlgIG1zIGFmdGVyIG1vc3RcbiAgICAgICAqIHJlY2VudCBleGVjdXRpb24uXG4gICAgICAgKlxuICAgICAgICogSWYgYGRlYm91bmNlTW9kZWAgaXMgdHJ1ZSAoYXQgYmVnaW4pLCBzY2hlZHVsZSBgY2xlYXJgIHRvIGV4ZWN1dGVcbiAgICAgICAqIGFmdGVyIGBkZWxheWAgbXMuXG4gICAgICAgKlxuICAgICAgICogSWYgYGRlYm91bmNlTW9kZWAgaXMgZmFsc2UgKGF0IGVuZCksIHNjaGVkdWxlIGBjYWxsYmFja2AgdG9cbiAgICAgICAqIGV4ZWN1dGUgYWZ0ZXIgYGRlbGF5YCBtcy5cbiAgICAgICAqL1xuICAgICAgdGltZW91dElEID0gc2V0VGltZW91dChkZWJvdW5jZU1vZGUgPyBjbGVhciA6IGV4ZWMsIGRlYm91bmNlTW9kZSA9PT0gdW5kZWZpbmVkID8gZGVsYXkgLSBlbGFwc2VkIDogZGVsYXkpO1xuICAgIH1cbiAgfVxuXG4gIHdyYXBwZXIuY2FuY2VsID0gY2FuY2VsOyAvLyBSZXR1cm4gdGhlIHdyYXBwZXIgZnVuY3Rpb24uXG5cbiAgcmV0dXJuIHdyYXBwZXI7XG59XG5cbi8qIGVzbGludC1kaXNhYmxlIG5vLXVuZGVmaW5lZCAqL1xuLyoqXG4gKiBEZWJvdW5jZSBleGVjdXRpb24gb2YgYSBmdW5jdGlvbi4gRGVib3VuY2luZywgdW5saWtlIHRocm90dGxpbmcsXG4gKiBndWFyYW50ZWVzIHRoYXQgYSBmdW5jdGlvbiBpcyBvbmx5IGV4ZWN1dGVkIGEgc2luZ2xlIHRpbWUsIGVpdGhlciBhdCB0aGVcbiAqIHZlcnkgYmVnaW5uaW5nIG9mIGEgc2VyaWVzIG9mIGNhbGxzLCBvciBhdCB0aGUgdmVyeSBlbmQuXG4gKlxuICogQHBhcmFtICB7bnVtYmVyfSAgIGRlbGF5IC0gICAgICAgICBBIHplcm8tb3ItZ3JlYXRlciBkZWxheSBpbiBtaWxsaXNlY29uZHMuIEZvciBldmVudCBjYWxsYmFja3MsIHZhbHVlcyBhcm91bmQgMTAwIG9yIDI1MCAob3IgZXZlbiBoaWdoZXIpIGFyZSBtb3N0IHVzZWZ1bC5cbiAqIEBwYXJhbSAge2Jvb2xlYW59ICBbYXRCZWdpbl0gLSAgICAgT3B0aW9uYWwsIGRlZmF1bHRzIHRvIGZhbHNlLiBJZiBhdEJlZ2luIGlzIGZhbHNlIG9yIHVuc3BlY2lmaWVkLCBjYWxsYmFjayB3aWxsIG9ubHkgYmUgZXhlY3V0ZWQgYGRlbGF5YCBtaWxsaXNlY29uZHNcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyIHRoZSBsYXN0IGRlYm91bmNlZC1mdW5jdGlvbiBjYWxsLiBJZiBhdEJlZ2luIGlzIHRydWUsIGNhbGxiYWNrIHdpbGwgYmUgZXhlY3V0ZWQgb25seSBhdCB0aGUgZmlyc3QgZGVib3VuY2VkLWZ1bmN0aW9uIGNhbGwuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoQWZ0ZXIgdGhlIHRocm90dGxlZC1mdW5jdGlvbiBoYXMgbm90IGJlZW4gY2FsbGVkIGZvciBgZGVsYXlgIG1pbGxpc2Vjb25kcywgdGhlIGludGVybmFsIGNvdW50ZXIgaXMgcmVzZXQpLlxuICogQHBhcmFtICB7RnVuY3Rpb259IGNhbGxiYWNrIC0gICAgICBBIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIGFmdGVyIGRlbGF5IG1pbGxpc2Vjb25kcy4gVGhlIGB0aGlzYCBjb250ZXh0IGFuZCBhbGwgYXJndW1lbnRzIGFyZSBwYXNzZWQgdGhyb3VnaCwgYXMtaXMsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0byBgY2FsbGJhY2tgIHdoZW4gdGhlIGRlYm91bmNlZC1mdW5jdGlvbiBpcyBleGVjdXRlZC5cbiAqXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgbmV3LCBkZWJvdW5jZWQgZnVuY3Rpb24uXG4gKi9cblxuZnVuY3Rpb24gZGVib3VuY2UgKGRlbGF5LCBhdEJlZ2luLCBjYWxsYmFjaykge1xuICByZXR1cm4gY2FsbGJhY2sgPT09IHVuZGVmaW5lZCA/IHRocm90dGxlKGRlbGF5LCBhdEJlZ2luLCBmYWxzZSkgOiB0aHJvdHRsZShkZWxheSwgY2FsbGJhY2ssIGF0QmVnaW4gIT09IGZhbHNlKTtcbn1cblxuZXhwb3J0IHsgZGVib3VuY2UsIHRocm90dGxlIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXBcbiJdLCJzb3VyY2VSb290IjoiIn0=