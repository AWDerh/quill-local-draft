(()=>{"use strict";var t=function(){return(t=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var o in i=arguments[n])Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o]);return t}).apply(this,arguments)},i={id:"",prefix:"quill_local_draft",saveDelay:1e3,displaySave:!0,bindInitial:!0};!function(){function n(t,i){this.quill=t,this.options=this.applyOptions(i),this.initialized=!1,this.options.bindInitial&&this.bindInitialListener()}n.prototype.init=function(){this.initialized||(this.initialized=!0,this.unbindListener(),this.loadDraft(),this.bindListener())},n.prototype.bindInitialListener=function(){var t=this;if(this.initialized)return this.bindListener();this.unbindListener(),this.listener=function(){return t.init()},this.quill.once("text-change",this.listener)},n.prototype.bindListener=function(){var t=this;this.unbindListener();var i=function(){return t.saveDraft()};this.listener=this.options.saveDelay?function(t,i,n,e){var o,r=!1,s=0;function a(){o&&clearTimeout(o)}function l(){for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];var c=this,f=Date.now()-s;function p(){s=Date.now(),n.apply(c,u)}function d(){o=void 0}r||(e&&!o&&p(),a(),void 0===e&&f>t?p():!0!==i&&(o=setTimeout(e?d:p,void 0===e?t-f:t)))}return"boolean"!=typeof i&&(e=n,n=i,i=void 0),l.cancel=function(){a(),r=!0},l}(this.options.saveDelay,i):i,this.quill.on("text-change",this.listener)},n.prototype.unbindListener=function(){this.listener&&this.quill.off("text-change",this.listener)},n.prototype.applyOptions=function(n){return t(t({},i),n)},Object.defineProperty(n.prototype,"id",{get:function(){var t;return(null!==(t=this.options.prefix)&&void 0!==t?t:"")+"_"+this.options.id},enumerable:!1,configurable:!0}),n.prototype.getContents=function(){return JSON.stringify(this.quill.getContents())},n.prototype.setContents=function(t){var i=null;try{i=JSON.parse(t)}catch(t){return void console.error("Could not parse local draft Delta.")}i&&this.quill.setContents(i)},n.prototype.getDraft=function(){var t,i=this.id,n="";try{n=null!==(t=localStorage.getItem(i))&&void 0!==t?t:""}catch(t){}return n},n.prototype.setDraft=function(t){void 0===t&&(t="");var i=this.id;try{localStorage.setItem(i,t)}catch(t){if(!(t instanceof DOMException&&t.code==t.QUOTA_EXCEEDED_ERR))throw t;console.error("Could not save local draft",t)}},n.prototype.saveDraft=function(){var t=this.getContents();this.setDraft(t)},n.prototype._loadDraft=function(){var t=this.getDraft();this.setContents(t)},n.prototype.editorIsEmpty=function(){return 0==this.quill.getText().trim().length},n.prototype.loadDraft=function(){return!(!this.editorIsEmpty()&&!window.confirm("There is a local saved draft for this notebook, but loading it would reset the editor. Do you still want to load the draft?"))&&this._loadDraft()}}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9xdWlsbC1sb2NhbC1kcmFmdC8uL3NyYy9RdWlsbExvY2FsRHJhZnQudHMiLCJ3ZWJwYWNrOi8vcXVpbGwtbG9jYWwtZHJhZnQvLi9ub2RlX21vZHVsZXMvdGhyb3R0bGUtZGVib3VuY2UvZXNtL2luZGV4LmpzIl0sIm5hbWVzIjpbIl9fYXNzaWduIiwiT2JqZWN0IiwiYXNzaWduIiwidCIsInMiLCJpIiwibiIsImFyZ3VtZW50cyIsImxlbmd0aCIsInAiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJhcHBseSIsInRoaXMiLCJERUZBVUxUX09QVElPTlMiLCJpZCIsInByZWZpeCIsInNhdmVEZWxheSIsImRpc3BsYXlTYXZlIiwiYmluZEluaXRpYWwiLCJRdWlsbExvY2FsRHJhZnQiLCJxdWlsbCIsIm9wdGlvbnMiLCJhcHBseU9wdGlvbnMiLCJpbml0aWFsaXplZCIsImJpbmRJbml0aWFsTGlzdGVuZXIiLCJpbml0IiwidW5iaW5kTGlzdGVuZXIiLCJsb2FkRHJhZnQiLCJiaW5kTGlzdGVuZXIiLCJfdGhpcyIsImxpc3RlbmVyIiwib25jZSIsInNhdmVEcmFmdCIsImRlbGF5Iiwibm9UcmFpbGluZyIsImNhbGxiYWNrIiwiZGVib3VuY2VNb2RlIiwidGltZW91dElEIiwiY2FuY2VsbGVkIiwibGFzdEV4ZWMiLCJjbGVhckV4aXN0aW5nVGltZW91dCIsImNsZWFyVGltZW91dCIsIndyYXBwZXIiLCJfbGVuIiwiYXJndW1lbnRzXyIsIkFycmF5IiwiX2tleSIsInNlbGYiLCJlbGFwc2VkIiwiRGF0ZSIsIm5vdyIsImV4ZWMiLCJjbGVhciIsInVuZGVmaW5lZCIsInNldFRpbWVvdXQiLCJjYW5jZWwiLCJ0aHJvdHRsZSIsIm9uIiwib2ZmIiwiZGVmaW5lUHJvcGVydHkiLCJnZXQiLCJfYSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJnZXRDb250ZW50cyIsIkpTT04iLCJzdHJpbmdpZnkiLCJzZXRDb250ZW50cyIsImNvbnRlbnRzIiwiZGVzZXJpYWxpemVkIiwicGFyc2UiLCJlIiwiY29uc29sZSIsImVycm9yIiwiZ2V0RHJhZnQiLCJkcmFmdCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXREcmFmdCIsImNvbnRlbnQiLCJzZXRJdGVtIiwiRE9NRXhjZXB0aW9uIiwiY29kZSIsIlFVT1RBX0VYQ0VFREVEX0VSUiIsIl9sb2FkRHJhZnQiLCJlZGl0b3JJc0VtcHR5IiwiZ2V0VGV4dCIsInRyaW0iLCJ3aW5kb3ciLCJjb25maXJtIl0sIm1hcHBpbmdzIjoibUJBR0EsSUFBSUEsRUFBc0MsV0FTdEMsT0FSQUEsRUFBV0MsT0FBT0MsUUFBVSxTQUFTQyxHQUNqQyxJQUFLLElBQUlDLEVBQUdDLEVBQUksRUFBR0MsRUFBSUMsVUFBVUMsT0FBUUgsRUFBSUMsRUFBR0QsSUFFNUMsSUFBSyxJQUFJSSxLQURUTCxFQUFJRyxVQUFVRixHQUNPSixPQUFPUyxVQUFVQyxlQUFlQyxLQUFLUixFQUFHSyxLQUN6RE4sRUFBRU0sR0FBS0wsRUFBRUssSUFFakIsT0FBT04sSUFFS1UsTUFBTUMsS0FBTVAsWUFHckJRLEVBQWtCLENBQ3pCQyxHQUFJLEdBQ0pDLE9BQVEsb0JBQ1JDLFVBQVcsSUFDWEMsYUFBYSxFQUNiQyxhQUFhLElBRW9CLFdBQ2pDLFNBQVNDLEVBQWdCQyxFQUFPQyxHQUM1QlQsS0FBS1EsTUFBUUEsRUFDYlIsS0FBS1MsUUFBVVQsS0FBS1UsYUFBYUQsR0FPakNULEtBQUtXLGFBQWMsRUFDZlgsS0FBS1MsUUFBUUgsYUFDYk4sS0FBS1ksc0JBRWJMLEVBQWdCWCxVQUFVaUIsS0FBTyxXQUN6QmIsS0FBS1csY0FFVFgsS0FBS1csYUFBYyxFQUNuQlgsS0FBS2MsaUJBQ0xkLEtBQUtlLFlBQ0xmLEtBQUtnQixpQkFFVFQsRUFBZ0JYLFVBQVVnQixvQkFBc0IsV0FDNUMsSUFBSUssRUFBUWpCLEtBQ1osR0FBSUEsS0FBS1csWUFDTCxPQUFPWCxLQUFLZ0IsZUFDaEJoQixLQUFLYyxpQkFFTGQsS0FBS2tC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QVd4RCxLQUFLb0QsY0FDcEJwRCxLQUFLa0UsU0FBU1YsSUFFbEJqRCxFQUFnQlgsVUFBVTRFLFdBQWEsV0FDbkMsSUFBSVQsRUFBUS9ELEtBQUs4RCxXQUNqQjlELEtBQUt1RCxZQUFZUSxJQUVyQnhELEVBQWdCWCxVQUFVNkUsY0FBZ0IsV0FDdEMsT0FBNkMsR0FBdEN6RSxLQUFLUSxNQUFNa0UsVUFBVUMsT0FBT2pGLFFBRXZDYSxFQUFnQlgsVUFBVW1CLFVBQVksV0FDbEMsU0FBS2YsS0FBS3lFLGtCQUNERyxPQUFPQyxRQUFRLGlJQUtqQjdFLEtBQUt3RSxjQWxIZ0IsSSIsImZpbGUiOiJxdWlsbExvY2FsRHJhZnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogRm9yIGN1c3RvbSB0eXBlcywgZXh0ZW5kIHRoaXMgcGx1Z2luIGFuZCBvdmVycmlkZSBAc2VlIGdldENvbnRlbnRzIC4uXHJcbiAqL1xyXG52YXIgX19hc3NpZ24gPSAodGhpcyAmJiB0aGlzLl9fYXNzaWduKSB8fCBmdW5jdGlvbiAoKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpXHJcbiAgICAgICAgICAgICAgICB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn07XHJcbmltcG9ydCB7IHRocm90dGxlIH0gZnJvbSAndGhyb3R0bGUtZGVib3VuY2UnO1xyXG5leHBvcnQgdmFyIERFRkFVTFRfT1BUSU9OUyA9IHtcclxuICAgIGlkOiAnJyxcclxuICAgIHByZWZpeDogJ3F1aWxsX2xvY2FsX2RyYWZ0JyxcclxuICAgIHNhdmVEZWxheTogMTAwMCxcclxuICAgIGRpc3BsYXlTYXZlOiB0cnVlLFxyXG4gICAgYmluZEluaXRpYWw6IHRydWVcclxufTtcclxudmFyIFF1aWxsTG9jYWxEcmFmdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFF1aWxsTG9jYWxEcmFmdChxdWlsbCwgb3B0aW9ucykge1xyXG4gICAgICAgIHRoaXMucXVpbGwgPSBxdWlsbDtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSB0aGlzLmFwcGx5T3B0aW9ucyhvcHRpb25zKTtcclxuICAgICAgICAvKlxyXG4gICAgICAgIFF1aWxsIHN0YXJ0J3MgdXAgd2l0aCBhIERPTSBsb2FkIGFuZCB0aGVuIG92ZXJ3cml0ZXMgdGhlIGVkaXRvciwgc28gd2UgY2FuJ3QgbG9hZCB0aGUgZHJhZnQganVzdCB5ZXQuXHJcbiAgICAgICAgVW5mb3J0dW5hdGVseSwgdGhlcmUncyBubyByZWxpYWJsZSBob29rIGVpdGhlci4uLiB0aGUgdGV4dCBlZGl0b3IgY2hhbmdlIGV2ZW50XHJcbiAgICAgICAgZG9lc24ndCBnZXQgY2FsbGVkIHVubGVzcyB0aGVyZSdzIHByZWRlZmluZWQgSFRNTCBjb250ZW50LiBTbyB3ZSByZWx5IG9uIGFwcGxpY2F0aW9uLXNwZWNpZmljXHJcbiAgICAgICAgaW5pdGlhbGl6YXRpb24uXHJcbiAgICAgICAgKi9cclxuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5iaW5kSW5pdGlhbClcclxuICAgICAgICAgICAgdGhpcy5iaW5kSW5pdGlhbExpc3RlbmVyKCk7XHJcbiAgICB9XHJcbiAgICBRdWlsbExvY2FsRHJhZnQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaW5pdGlhbGl6ZWQpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnVuYmluZExpc3RlbmVyKCk7XHJcbiAgICAgICAgdGhpcy5sb2FkRHJhZnQoKTtcclxuICAgICAgICB0aGlzLmJpbmRMaXN0ZW5lcigpO1xyXG4gICAgfTtcclxuICAgIFF1aWxsTG9jYWxEcmFmdC5wcm90b3R5cGUuYmluZEluaXRpYWxMaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICh0aGlzLmluaXRpYWxpemVkKVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5iaW5kTGlzdGVuZXIoKTtcclxuICAgICAgICB0aGlzLnVuYmluZExpc3RlbmVyKCk7XHJcbiAgICAgICAgdmFyIGxpc3RlbmVyID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuaW5pdCgpOyB9O1xyXG4gICAgICAgIHRoaXMubGlzdGVuZXIgPSBsaXN0ZW5lcjtcclxuICAgICAgICB0aGlzLnF1aWxsLm9uY2UoJ3RleHQtY2hhbmdlJywgdGhpcy5saXN0ZW5lcik7XHJcbiAgICB9O1xyXG4gICAgUXVpbGxMb2NhbERyYWZ0LnByb3RvdHlwZS5iaW5kTGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLnVuYmluZExpc3RlbmVyKCk7XHJcbiAgICAgICAgdmFyIGxpc3RlbmVyID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2F2ZURyYWZ0KCk7IH07XHJcbiAgICAgICAgdGhpcy5saXN0ZW5lciA9IHRoaXMub3B0aW9ucy5zYXZlRGVsYXkgPyB0aHJvdHRsZSh0aGlzLm9wdGlvbnMuc2F2ZURlbGF5LCBsaXN0ZW5lcikgOiBsaXN0ZW5lcjtcclxuICAgICAgICB0aGlzLnF1aWxsLm9uKCd0ZXh0LWNoYW5nZScsIHRoaXMubGlzdGVuZXIpO1xyXG4gICAgfTtcclxuICAgIFF1aWxsTG9jYWxEcmFmdC5wcm90b3R5cGUudW5iaW5kTGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmxpc3RlbmVyKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgdGhpcy5xdWlsbC5vZmYoJ3RleHQtY2hhbmdlJywgdGhpcy5saXN0ZW5lcik7XHJcbiAgICB9O1xyXG4gICAgUXVpbGxMb2NhbERyYWZ0LnByb3RvdHlwZS5hcHBseU9wdGlvbnMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgIHJldHVybiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgREVGQVVMVF9PUFRJT05TKSwgb3B0aW9ucyk7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFF1aWxsTG9jYWxEcmFmdC5wcm90b3R5cGUsIFwiaWRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgICAgIHJldHVybiAoKF9hID0gdGhpcy5vcHRpb25zLnByZWZpeCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogJycpICsgJ18nICsgdGhpcy5vcHRpb25zLmlkO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIFF1aWxsTG9jYWxEcmFmdC5wcm90b3R5cGUuZ2V0Q29udGVudHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMucXVpbGwuZ2V0Q29udGVudHMoKSk7XHJcbiAgICB9O1xyXG4gICAgUXVpbGxMb2NhbERyYWZ0LnByb3RvdHlwZS5zZXRDb250ZW50cyA9IGZ1bmN0aW9uIChjb250ZW50cykge1xyXG4gICAgICAgIHZhciBkZXNlcmlhbGl6ZWQgPSBudWxsO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGRlc2VyaWFsaXplZCA9IEpTT04ucGFyc2UoY29udGVudHMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ291bGQgbm90IHBhcnNlIGxvY2FsIGRyYWZ0IERlbHRhLlwiKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZGVzZXJpYWxpemVkKVxyXG4gICAgICAgICAgICB0aGlzLnF1aWxsLnNldENvbnRlbnRzKGRlc2VyaWFsaXplZCk7XHJcbiAgICB9O1xyXG4gICAgUXVpbGxMb2NhbERyYWZ0LnByb3RvdHlwZS5nZXREcmFmdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgdmFyIGlkID0gdGhpcy5pZDtcclxuICAgICAgICB2YXIgZHJhZnQgPSAnJztcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBkcmFmdCA9IChfYSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGlkKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogJyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIC8vID9cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRyYWZ0O1xyXG4gICAgfTtcclxuICAgIFF1aWxsTG9jYWxEcmFmdC5wcm90b3R5cGUuc2V0RHJhZnQgPSBmdW5jdGlvbiAoY29udGVudCkge1xyXG4gICAgICAgIGlmIChjb250ZW50ID09PSB2b2lkIDApIHsgY29udGVudCA9ICcnOyB9XHJcbiAgICAgICAgdmFyIGlkID0gdGhpcy5pZDtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShpZCwgY29udGVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgRE9NRXhjZXB0aW9uICYmIGUuY29kZSA9PSBlLlFVT1RBX0VYQ0VFREVEX0VSUikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkNvdWxkIG5vdCBzYXZlIGxvY2FsIGRyYWZ0XCIsIGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgKGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFF1aWxsTG9jYWxEcmFmdC5wcm90b3R5cGUuc2F2ZURyYWZ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBjb250ZW50cyA9IHRoaXMuZ2V0Q29udGVudHMoKTtcclxuICAgICAgICB0aGlzLnNldERyYWZ0KGNvbnRlbnRzKTtcclxuICAgIH07XHJcbiAgICBRdWlsbExvY2FsRHJhZnQucHJvdG90eXBlLl9sb2FkRHJhZnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGRyYWZ0ID0gdGhpcy5nZXREcmFmdCgpO1xyXG4gICAgICAgIHRoaXMuc2V0Q29udGVudHMoZHJhZnQpO1xyXG4gICAgfTtcclxuICAgIFF1aWxsTG9jYWxEcmFmdC5wcm90b3R5cGUuZWRpdG9ySXNFbXB0eSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5xdWlsbC5nZXRUZXh0KCkudHJpbSgpLmxlbmd0aCA9PSAwO1xyXG4gICAgfTtcclxuICAgIFF1aWxsTG9jYWxEcmFmdC5wcm90b3R5cGUubG9hZERyYWZ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5lZGl0b3JJc0VtcHR5KCkpIHtcclxuICAgICAgICAgICAgaWYgKCF3aW5kb3cuY29uZmlybShcIlRoZXJlIGlzIGEgbG9jYWwgc2F2ZWQgZHJhZnQgZm9yIHRoaXMgbm90ZWJvb2ssXCJcclxuICAgICAgICAgICAgICAgICsgXCIgYnV0IGxvYWRpbmcgaXQgd291bGQgcmVzZXQgdGhlIGVkaXRvci4gRG8geW91IHN0aWxsIHdhbnQgdG8gbG9hZCB0aGUgZHJhZnQ/XCIpKVxyXG4gICAgICAgICAgICAgICAgLy8gY2FuIHRoZXkgbm90IHVuZG8gdGhlIGRyYWZ0IGxvYWQ/XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLl9sb2FkRHJhZnQoKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gUXVpbGxMb2NhbERyYWZ0O1xyXG59KCkpO1xyXG5leHBvcnQgeyBRdWlsbExvY2FsRHJhZnQgfTtcclxuZXhwb3J0IGRlZmF1bHQgUXVpbGxMb2NhbERyYWZ0O1xyXG4iLCIvKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZmluZWQsbm8tcGFyYW0tcmVhc3NpZ24sbm8tc2hhZG93ICovXG5cbi8qKlxuICogVGhyb3R0bGUgZXhlY3V0aW9uIG9mIGEgZnVuY3Rpb24uIEVzcGVjaWFsbHkgdXNlZnVsIGZvciByYXRlIGxpbWl0aW5nXG4gKiBleGVjdXRpb24gb2YgaGFuZGxlcnMgb24gZXZlbnRzIGxpa2UgcmVzaXplIGFuZCBzY3JvbGwuXG4gKlxuICogQHBhcmFtICB7bnVtYmVyfSAgICBkZWxheSAtICAgICAgICAgIEEgemVyby1vci1ncmVhdGVyIGRlbGF5IGluIG1pbGxpc2Vjb25kcy4gRm9yIGV2ZW50IGNhbGxiYWNrcywgdmFsdWVzIGFyb3VuZCAxMDAgb3IgMjUwIChvciBldmVuIGhpZ2hlcikgYXJlIG1vc3QgdXNlZnVsLlxuICogQHBhcmFtICB7Ym9vbGVhbn0gICBbbm9UcmFpbGluZ10gLSAgIE9wdGlvbmFsLCBkZWZhdWx0cyB0byBmYWxzZS4gSWYgbm9UcmFpbGluZyBpcyB0cnVlLCBjYWxsYmFjayB3aWxsIG9ubHkgZXhlY3V0ZSBldmVyeSBgZGVsYXlgIG1pbGxpc2Vjb25kcyB3aGlsZSB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3R0bGVkLWZ1bmN0aW9uIGlzIGJlaW5nIGNhbGxlZC4gSWYgbm9UcmFpbGluZyBpcyBmYWxzZSBvciB1bnNwZWNpZmllZCwgY2FsbGJhY2sgd2lsbCBiZSBleGVjdXRlZCBvbmUgZmluYWwgdGltZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlciB0aGUgbGFzdCB0aHJvdHRsZWQtZnVuY3Rpb24gY2FsbC4gKEFmdGVyIHRoZSB0aHJvdHRsZWQtZnVuY3Rpb24gaGFzIG5vdCBiZWVuIGNhbGxlZCBmb3IgYGRlbGF5YCBtaWxsaXNlY29uZHMsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBpbnRlcm5hbCBjb3VudGVyIGlzIHJlc2V0KS5cbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgLSAgICAgICBBIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIGFmdGVyIGRlbGF5IG1pbGxpc2Vjb25kcy4gVGhlIGB0aGlzYCBjb250ZXh0IGFuZCBhbGwgYXJndW1lbnRzIGFyZSBwYXNzZWQgdGhyb3VnaCwgYXMtaXMsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIGBjYWxsYmFja2Agd2hlbiB0aGUgdGhyb3R0bGVkLWZ1bmN0aW9uIGlzIGV4ZWN1dGVkLlxuICogQHBhcmFtICB7Ym9vbGVhbn0gICBbZGVib3VuY2VNb2RlXSAtIElmIGBkZWJvdW5jZU1vZGVgIGlzIHRydWUgKGF0IGJlZ2luKSwgc2NoZWR1bGUgYGNsZWFyYCB0byBleGVjdXRlIGFmdGVyIGBkZWxheWAgbXMuIElmIGBkZWJvdW5jZU1vZGVgIGlzIGZhbHNlIChhdCBlbmQpLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZSBgY2FsbGJhY2tgIHRvIGV4ZWN1dGUgYWZ0ZXIgYGRlbGF5YCBtcy5cbiAqXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259ICBBIG5ldywgdGhyb3R0bGVkLCBmdW5jdGlvbi5cbiAqL1xuZnVuY3Rpb24gdGhyb3R0bGUgKGRlbGF5LCBub1RyYWlsaW5nLCBjYWxsYmFjaywgZGVib3VuY2VNb2RlKSB7XG4gIC8qXG4gICAqIEFmdGVyIHdyYXBwZXIgaGFzIHN0b3BwZWQgYmVpbmcgY2FsbGVkLCB0aGlzIHRpbWVvdXQgZW5zdXJlcyB0aGF0XG4gICAqIGBjYWxsYmFja2AgaXMgZXhlY3V0ZWQgYXQgdGhlIHByb3BlciB0aW1lcyBpbiBgdGhyb3R0bGVgIGFuZCBgZW5kYFxuICAgKiBkZWJvdW5jZSBtb2Rlcy5cbiAgICovXG4gIHZhciB0aW1lb3V0SUQ7XG4gIHZhciBjYW5jZWxsZWQgPSBmYWxzZTsgLy8gS2VlcCB0cmFjayBvZiB0aGUgbGFzdCB0aW1lIGBjYWxsYmFja2Agd2FzIGV4ZWN1dGVkLlxuXG4gIHZhciBsYXN0RXhlYyA9IDA7IC8vIEZ1bmN0aW9uIHRvIGNsZWFyIGV4aXN0aW5nIHRpbWVvdXRcblxuICBmdW5jdGlvbiBjbGVhckV4aXN0aW5nVGltZW91dCgpIHtcbiAgICBpZiAodGltZW91dElEKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZW91dElEKTtcbiAgICB9XG4gIH0gLy8gRnVuY3Rpb24gdG8gY2FuY2VsIG5leHQgZXhlY1xuXG5cbiAgZnVuY3Rpb24gY2FuY2VsKCkge1xuICAgIGNsZWFyRXhpc3RpbmdUaW1lb3V0KCk7XG4gICAgY2FuY2VsbGVkID0gdHJ1ZTtcbiAgfSAvLyBgbm9UcmFpbGluZ2AgZGVmYXVsdHMgdG8gZmFsc3kuXG5cblxuICBpZiAodHlwZW9mIG5vVHJhaWxpbmcgIT09ICdib29sZWFuJykge1xuICAgIGRlYm91bmNlTW9kZSA9IGNhbGxiYWNrO1xuICAgIGNhbGxiYWNrID0gbm9UcmFpbGluZztcbiAgICBub1RyYWlsaW5nID0gdW5kZWZpbmVkO1xuICB9XG4gIC8qXG4gICAqIFRoZSBgd3JhcHBlcmAgZnVuY3Rpb24gZW5jYXBzdWxhdGVzIGFsbCBvZiB0aGUgdGhyb3R0bGluZyAvIGRlYm91bmNpbmdcbiAgICogZnVuY3Rpb25hbGl0eSBhbmQgd2hlbiBleGVjdXRlZCB3aWxsIGxpbWl0IHRoZSByYXRlIGF0IHdoaWNoIGBjYWxsYmFja2BcbiAgICogaXMgZXhlY3V0ZWQuXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gd3JhcHBlcigpIHtcbiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJndW1lbnRzXyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICAgIGFyZ3VtZW50c19bX2tleV0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgfVxuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBlbGFwc2VkID0gRGF0ZS5ub3coKSAtIGxhc3RFeGVjO1xuXG4gICAgaWYgKGNhbmNlbGxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH0gLy8gRXhlY3V0ZSBgY2FsbGJhY2tgIGFuZCB1cGRhdGUgdGhlIGBsYXN0RXhlY2AgdGltZXN0YW1wLlxuXG5cbiAgICBmdW5jdGlvbiBleGVjKCkge1xuICAgICAgbGFzdEV4ZWMgPSBEYXRlLm5vdygpO1xuICAgICAgY2FsbGJhY2suYXBwbHkoc2VsZiwgYXJndW1lbnRzXyk7XG4gICAgfVxuICAgIC8qXG4gICAgICogSWYgYGRlYm91bmNlTW9kZWAgaXMgdHJ1ZSAoYXQgYmVnaW4pIHRoaXMgaXMgdXNlZCB0byBjbGVhciB0aGUgZmxhZ1xuICAgICAqIHRvIGFsbG93IGZ1dHVyZSBgY2FsbGJhY2tgIGV4ZWN1dGlvbnMuXG4gICAgICovXG5cblxuICAgIGZ1bmN0aW9uIGNsZWFyKCkge1xuICAgICAgdGltZW91dElEID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGlmIChkZWJvdW5jZU1vZGUgJiYgIXRpbWVvdXRJRCkge1xuICAgICAgLypcbiAgICAgICAqIFNpbmNlIGB3cmFwcGVyYCBpcyBiZWluZyBjYWxsZWQgZm9yIHRoZSBmaXJzdCB0aW1lIGFuZFxuICAgICAgICogYGRlYm91bmNlTW9kZWAgaXMgdHJ1ZSAoYXQgYmVnaW4pLCBleGVjdXRlIGBjYWxsYmFja2AuXG4gICAgICAgKi9cbiAgICAgIGV4ZWMoKTtcbiAgICB9XG5cbiAgICBjbGVhckV4aXN0aW5nVGltZW91dCgpO1xuXG4gICAgaWYgKGRlYm91bmNlTW9kZSA9PT0gdW5kZWZpbmVkICYmIGVsYXBzZWQgPiBkZWxheSkge1xuICAgICAgLypcbiAgICAgICAqIEluIHRocm90dGxlIG1vZGUsIGlmIGBkZWxheWAgdGltZSBoYXMgYmVlbiBleGNlZWRlZCwgZXhlY3V0ZVxuICAgICAgICogYGNhbGxiYWNrYC5cbiAgICAgICAqL1xuICAgICAgZXhlYygpO1xuICAgIH0gZWxzZSBpZiAobm9UcmFpbGluZyAhPT0gdHJ1ZSkge1xuICAgICAgLypcbiAgICAgICAqIEluIHRyYWlsaW5nIHRocm90dGxlIG1vZGUsIHNpbmNlIGBkZWxheWAgdGltZSBoYXMgbm90IGJlZW5cbiAgICAgICAqIGV4Y2VlZGVkLCBzY2hlZHVsZSBgY2FsbGJhY2tgIHRvIGV4ZWN1dGUgYGRlbGF5YCBtcyBhZnRlciBtb3N0XG4gICAgICAgKiByZWNlbnQgZXhlY3V0aW9uLlxuICAgICAgICpcbiAgICAgICAqIElmIGBkZWJvdW5jZU1vZGVgIGlzIHRydWUgKGF0IGJlZ2luKSwgc2NoZWR1bGUgYGNsZWFyYCB0byBleGVjdXRlXG4gICAgICAgKiBhZnRlciBgZGVsYXlgIG1zLlxuICAgICAgICpcbiAgICAgICAqIElmIGBkZWJvdW5jZU1vZGVgIGlzIGZhbHNlIChhdCBlbmQpLCBzY2hlZHVsZSBgY2FsbGJhY2tgIHRvXG4gICAgICAgKiBleGVjdXRlIGFmdGVyIGBkZWxheWAgbXMuXG4gICAgICAgKi9cbiAgICAgIHRpbWVvdXRJRCA9IHNldFRpbWVvdXQoZGVib3VuY2VNb2RlID8gY2xlYXIgOiBleGVjLCBkZWJvdW5jZU1vZGUgPT09IHVuZGVmaW5lZCA/IGRlbGF5IC0gZWxhcHNlZCA6IGRlbGF5KTtcbiAgICB9XG4gIH1cblxuICB3cmFwcGVyLmNhbmNlbCA9IGNhbmNlbDsgLy8gUmV0dXJuIHRoZSB3cmFwcGVyIGZ1bmN0aW9uLlxuXG4gIHJldHVybiB3cmFwcGVyO1xufVxuXG4vKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZmluZWQgKi9cbi8qKlxuICogRGVib3VuY2UgZXhlY3V0aW9uIG9mIGEgZnVuY3Rpb24uIERlYm91bmNpbmcsIHVubGlrZSB0aHJvdHRsaW5nLFxuICogZ3VhcmFudGVlcyB0aGF0IGEgZnVuY3Rpb24gaXMgb25seSBleGVjdXRlZCBhIHNpbmdsZSB0aW1lLCBlaXRoZXIgYXQgdGhlXG4gKiB2ZXJ5IGJlZ2lubmluZyBvZiBhIHNlcmllcyBvZiBjYWxscywgb3IgYXQgdGhlIHZlcnkgZW5kLlxuICpcbiAqIEBwYXJhbSAge251bWJlcn0gICBkZWxheSAtICAgICAgICAgQSB6ZXJvLW9yLWdyZWF0ZXIgZGVsYXkgaW4gbWlsbGlzZWNvbmRzLiBGb3IgZXZlbnQgY2FsbGJhY2tzLCB2YWx1ZXMgYXJvdW5kIDEwMCBvciAyNTAgKG9yIGV2ZW4gaGlnaGVyKSBhcmUgbW9zdCB1c2VmdWwuXG4gKiBAcGFyYW0gIHtib29sZWFufSAgW2F0QmVnaW5dIC0gICAgIE9wdGlvbmFsLCBkZWZhdWx0cyB0byBmYWxzZS4gSWYgYXRCZWdpbiBpcyBmYWxzZSBvciB1bnNwZWNpZmllZCwgY2FsbGJhY2sgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIGBkZWxheWAgbWlsbGlzZWNvbmRzXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlciB0aGUgbGFzdCBkZWJvdW5jZWQtZnVuY3Rpb24gY2FsbC4gSWYgYXRCZWdpbiBpcyB0cnVlLCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIG9ubHkgYXQgdGhlIGZpcnN0IGRlYm91bmNlZC1mdW5jdGlvbiBjYWxsLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKEFmdGVyIHRoZSB0aHJvdHRsZWQtZnVuY3Rpb24gaGFzIG5vdCBiZWVuIGNhbGxlZCBmb3IgYGRlbGF5YCBtaWxsaXNlY29uZHMsIHRoZSBpbnRlcm5hbCBjb3VudGVyIGlzIHJlc2V0KS5cbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayAtICAgICAgQSBmdW5jdGlvbiB0byBiZSBleGVjdXRlZCBhZnRlciBkZWxheSBtaWxsaXNlY29uZHMuIFRoZSBgdGhpc2AgY29udGV4dCBhbmQgYWxsIGFyZ3VtZW50cyBhcmUgcGFzc2VkIHRocm91Z2gsIGFzLWlzLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG8gYGNhbGxiYWNrYCB3aGVuIHRoZSBkZWJvdW5jZWQtZnVuY3Rpb24gaXMgZXhlY3V0ZWQuXG4gKlxuICogQHJldHVybnMge0Z1bmN0aW9ufSBBIG5ldywgZGVib3VuY2VkIGZ1bmN0aW9uLlxuICovXG5cbmZ1bmN0aW9uIGRlYm91bmNlIChkZWxheSwgYXRCZWdpbiwgY2FsbGJhY2spIHtcbiAgcmV0dXJuIGNhbGxiYWNrID09PSB1bmRlZmluZWQgPyB0aHJvdHRsZShkZWxheSwgYXRCZWdpbiwgZmFsc2UpIDogdGhyb3R0bGUoZGVsYXksIGNhbGxiYWNrLCBhdEJlZ2luICE9PSBmYWxzZSk7XG59XG5cbmV4cG9ydCB7IGRlYm91bmNlLCB0aHJvdHRsZSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwXG4iXSwic291cmNlUm9vdCI6IiJ9